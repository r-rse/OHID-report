[
  {
    "objectID": "01_SPHERE-review.html",
    "href": "01_SPHERE-review.html",
    "title": "SPHERE-review",
    "section": "",
    "text": "While renv is best suited for project rather than package dependency management, once functionality is packaged separately, actual modelling runs will be more stable managed by package renv.\nWhile the use of checkpoint is indeed a good start, there is a lot of code dedicated to effectively reproducing renv functionality. More importantly,\n\nlists of packages appear to be managed manually and separately for CRAN & GitHub packages. All of this can be handled automatically by renv through renv.lock files.\nExact project libraries based on such files can be easily installed with renv::restore(),\nUpdates can be performed normally using for example, remotes::update_packages and the library updated with renv::snapshots().\nLockfiles can be version controlled alongside code in renv::history() can be used view the history of the lockfile. If an upgrade goes astray, you can revert the lockfile to a specific commit, e.g. renv::revert(commit = \"abc123\")\nFinally renv::equip() ensures that system prerequisites for compilation of a package are available (e.g Rtools on windows).\n\n\n\n\n\n\n\n\n\nIt is not good practice to be updating or installing packages as part of the workflow. It is better to separate that step.\n\n\n\nWhile user inputs are well documented and easily configurable through the user-input.R file, it’s better practice to manage user configuration inputs more formally through a config file and access them through package config\n\n\n\n\n\nEnsures config values are used explicitly avoiding having all loaded into the global environment where they can potentially be overwritten.\nAllows for different configurations to be set for different environments/situations which can be specifically activated by setting a single environment variable: R_CONFIG_ACTIVE .\nAs such configurations under different scenarios can be stored in the same file rather than being overwritten in use-input.R every time a different configuration is required, increasing transparency.\nConfigurations for HPC can also be explicitly set in the config file and activated by setting R_CONFIG_ACTIVE to e.g. HPC . This would be far more robust than the current detection of unix as the OS which is not explicit enough and could cause problems should a user be running the modelling workflow on a local unix system or even testing the workflow out in a unix docker container (an issue I encountered)."
  },
  {
    "objectID": "01_SPHERE-review.html#orchestrating-workflows-with-targets-package",
    "href": "01_SPHERE-review.html#orchestrating-workflows-with-targets-package",
    "title": "SPHERE-review",
    "section": "Orchestrating workflows with targets package",
    "text": "Orchestrating workflows with targets package\nGiven a large part of the software is composed of orchestrating workflows and chaining models together, using package targets is strongly recommended.\n\nThe targets package is a Make-like pipeline tool for Statistics and data science in R. With targets, you can maintain a reproducible workflow without repeating yourself. targets learns how your pipeline fits together, skips costly runtime for tasks that are already up to date, runs only the necessary computation, supports implicit parallel computing, abstracts files as R objects, and shows tangible evidence that the results match the underlying code and data.\n\n\n\n\n\n\n\n\n\nCode repetition\nThe code appears to be very repetive in parts, for example"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "1 + 1\n\n[1] 2"
  },
  {
    "objectID": "02_SPHERE-debugging.html",
    "href": "02_SPHERE-debugging.html",
    "title": "SPHERE-debugging",
    "section": "",
    "text": "Getting an error straight away when trying to source launch.R as\n\nsource(\"launch.R\")\n#> ##------ Mon Sep 19 13:00:30 2022 ------##\n#> Launching SPHERE Modelling Platform on dcs33297\n#> Error in setwd(wd_path) : cannot change working directory\n\nIt looks like you are trying to set the working directory as the parent of launch.R? This seems a really brittle approach. It’s mcuh better to avoid setting working directories and rather assume all processes will be performed in the root of the directory and use relative paths from the root for everything else.\nI had to comment setwd(wd_path) out.\nIf this MUST be used (which should be extremely rare), it is best to use on.exit(setwd(here::here())) to ensure the wd is reset in case of an error (this only works within functions however).\n\n\nIt took me quite some time to figure out that there is hidden structure expected.\nI had placed the sqlite database in a given folder, let’s say the Desktops (~/Desktop) for illustrative purposes and changed the value of HPC_datapath in private.csv to ~/Desktop .\nHowever the code expects a folder the same name as the value of LiveProject_db in which the database should be contained (i.e. the actual path to the database was being assigned to data_dir as ~/Documents/workflows/OHID/data/Y063_SynthMod and the full path resolving to \"~/Documents/workflows/OHID/data/Y063_SynthMod/Y103_SynthMod_dev.db\" . This is both unexpected and somewhat undocumented. Checking that the path actually resolved to a database file with an informative error that actually prints the path where the data is expected would have helped a lot.\n\n\n\nThe practice is not best practice and brittle for a number of reasons:\nNecessity to manually track dependencies when this can be automated with renv. Changes to the local library can be captured with renv::snapshot() while dependencies required for scripts in a particular directory can be identified with renv::dependencies(). If you did need to load a whole bunch of packages for a module you could use: .\n\nrenv::dependencies()$Package |> \n    unique() |> \n    lapply(require, character.only = TRUE)\n\nFinding R package dependencies ... Done!\n\n\nLoading required package: knitr\n\n\nLoading required package: rmarkdown\n\n\nLoading required package: renv\n\n\n\nAttaching package: 'renv'\n\n\nThe following object is masked from 'package:rmarkdown':\n\n    run\n\n\nThe following objects are masked from 'package:stats':\n\n    embed, update\n\n\nThe following objects are masked from 'package:utils':\n\n    history, upgrade\n\n\nThe following object is masked from 'package:devtools':\n\n    install\n\n\nThe following objects are masked from 'package:base':\n\n    autoload, load, remove\n\n\n[[1]]\n[1] TRUE\n\n[[2]]\n[1] TRUE\n\n[[3]]\n[1] TRUE\n\n\nEven better would be to clean up afterwards with:\n\nmodule_deps <- renv::dependencies()$Package |> \n    unique() \n\nlapply(module_deps, require, character.only = TRUE)\n\n# MODULE CODE\n\nlapply(paste0(\"package:\", module_deps), detach, character.only = TRUE, force = TRUE)\n\nHowever the order in which dependencies are unlinked become important and errors might be thrown if a package which is a dependency of another loaded package is attempted to be detached first while forcing detachment with force = TRUE might compromise the functioning of other packages unrelated to the module.\nIn any case, all this can be avoided by not loading and unloading packages which pollutes the search path. Instead it is STRONGLY recommended that functions are called using the :: operator. Performance gains are not worth the problems having so many packages loaded introduces, makes the function namespace explicit in the code. A few key packages like dplyr that are used heavily throughout can be loaded.\n\n\n\nI’m using the default attribute in user-input.R list:\nBirthdate BinaryCHD BinaryCKD BinaryColC BinaryPA BinaryPIA BinaryStroke BinaryT2DM Binary5PD BMIPercentile DeathCause EthGrp HLQ IMDDecile Income LTLA19 NSSEC RBAC11 RUC11 SBPPercentile Sex SexualOrientation TTWDistance TTWMethod\nHowever, IMDDecile does not exist in the meta_DistributionVariables in Y103_SynthMod_dev.db and create-variable-groupings.R fails with a not very informative error which does not prompt user on what needs rectifying. Ideally this could be handled automatically (i.e. the attribute ignored and a warning issued to the user to inform them) or at the very least, an error which directs the user to the user-inputs.R to change the setting for IMDDecile to FALSE . In any case it feels like this should have been checked earlier and more formally.\n\n\n\nWorking on a mac which evaluates to a unix system, launch.R would quit on me at the end of the session even in interactive mode.\n\n\n\nThe NOMIS query returns NA results\n\nstructure(list(GEOGRAPHY_CODE = c(\"E06000005\", \"E06000005\", \"E06000005\", \n\"E06000005\", \"E06000005\", \"E06000005\", \"E06000005\", \"E06000047\", \n\"E06000047\", \"E06000047\", \"E06000047\", \"E06000047\", \"E06000047\", \n\"E06000047\", \"E06000001\", \"E06000001\", \"E06000001\", \"E06000001\", \n\"E06000001\", \"E06000001\"), MEASURE = c(6, 7, 8, 9, 10, 11, 5, \n6, 7, 8, 9, 10, 11, 5, 6, 7, 8, 9, 10, 11), OBS_VALUE = c(NA, \nNA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, \nNA, NA, NA)), row.names = c(NA, -20L), class = c(\"tbl_df\", \"tbl\", \n\"data.frame\"))\n\n   GEOGRAPHY_CODE MEASURE OBS_VALUE\n1       E06000005       6        NA\n2       E06000005       7        NA\n3       E06000005       8        NA\n4       E06000005       9        NA\n5       E06000005      10        NA\n6       E06000005      11        NA\n7       E06000005       5        NA\n8       E06000047       6        NA\n9       E06000047       7        NA\n10      E06000047       8        NA\n11      E06000047       9        NA\n12      E06000047      10        NA\n13      E06000047      11        NA\n14      E06000047       5        NA\n15      E06000001       6        NA\n16      E06000001       7        NA\n17      E06000001       8        NA\n18      E06000001       9        NA\n19      E06000001      10        NA\n20      E06000001      11        NA\n\n\nhere’s the full response\n\nstructure(list(DATE = c(2021, 2021, 2021, 2021, 2021, 2021, 2021, \n2021, 2021, 2021), DATE_NAME = c(2021, 2021, 2021, 2021, 2021, \n2021, 2021, 2021, 2021, 2021), DATE_CODE = c(2021, 2021, 2021, \n2021, 2021, 2021, 2021, 2021, 2021, 2021), DATE_TYPE = c(\"date\", \n\"date\", \"date\", \"date\", \"date\", \"date\", \"date\", \"date\", \"date\", \n\"date\"), DATE_TYPECODE = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0), DATE_SORTORDER = c(0, \n0, 0, 0, 0, 0, 0, 0, 0, 0), GEOGRAPHY = c(1820327937, 1820327937, \n1820327937, 1820327937, 1820327937, 1820327937, 1820327937, 1820327938, \n1820327938, 1820327938), GEOGRAPHY_NAME = c(\"Darlington\", \"Darlington\", \n\"Darlington\", \"Darlington\", \"Darlington\", \"Darlington\", \"Darlington\", \n\"County Durham\", \"County Durham\", \"County Durham\"), GEOGRAPHY_CODE = c(\"E06000005\", \n\"E06000005\", \"E06000005\", \"E06000005\", \"E06000005\", \"E06000005\", \n\"E06000005\", \"E06000047\", \"E06000047\", \"E06000047\"), GEOGRAPHY_TYPE = c(\"local authorities: district / unitary (as of April 2019)\", \n\"local authorities: district / unitary (as of April 2019)\", \"local authorities: district / unitary (as of April 2019)\", \n\"local authorities: district / unitary (as of April 2019)\", \"local authorities: district / unitary (as of April 2019)\", \n\"local authorities: district / unitary (as of April 2019)\", \"local authorities: district / unitary (as of April 2019)\", \n\"local authorities: district / unitary (as of April 2019)\", \"local authorities: district / unitary (as of April 2019)\", \n\"local authorities: district / unitary (as of April 2019)\"), \n    GEOGRAPHY_TYPECODE = c(434, 434, 434, 434, 434, 434, 434, \n    434, 434, 434), GEOGRAPHY_SORTORDER = c(0, 0, 0, 0, 0, 0, \n    0, 1, 1, 1), MEASURE = c(6, 7, 8, 9, 10, 11, 5, 6, 7, 8), \n    MEASURE_NAME = c(\"Age specific fertility rate : Aged 20-24\", \n    \"Age specific fertility rate : Aged 25-29\", \"Age specific fertility rate : Aged 30-34\", \n    \"Age specific fertility rate : Aged 35-39\", \"Age specific fertility rate : Aged 40-44\", \n    \"Age specific fertility rate : Aged 45 and over\", \"Age specific fertility rate : Aged under 20\", \n    \"Age specific fertility rate : Aged 20-24\", \"Age specific fertility rate : Aged 25-29\", \n    \"Age specific fertility rate : Aged 30-34\"), MEASURE_CODE = c(6, \n    7, 8, 9, 10, 11, 5, 6, 7, 8), MEASURE_TYPE = c(\"measures\", \n    \"measures\", \"measures\", \"measures\", \"measures\", \"measures\", \n    \"measures\", \"measures\", \"measures\", \"measures\"), MEASURE_TYPECODE = c(1000, \n    1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000), MEASURE_SORTORDER = c(0, \n    1, 2, 3, 4, 5, 6, 0, 1, 2), MEASURES = c(20100, 20100, 20100, \n    20100, 20100, 20100, 20100, 20100, 20100, 20100), MEASURES_NAME = c(\"Value\", \n    \"Value\", \"Value\", \"Value\", \"Value\", \"Value\", \"Value\", \"Value\", \n    \"Value\", \"Value\"), OBS_VALUE = c(NA, NA, NA, NA, NA, NA, \n    NA, NA, NA, NA), OBS_STATUS = c(\"Q\", \"Q\", \"Q\", \"Q\", \"Q\", \n    \"Q\", \"Q\", \"Q\", \"Q\", \"Q\"), OBS_STATUS_NAME = c(\"These figures are missing.\", \n    \"These figures are missing.\", \"These figures are missing.\", \n    \"These figures are missing.\", \"These figures are missing.\", \n    \"These figures are missing.\", \"These figures are missing.\", \n    \"These figures are missing.\", \"These figures are missing.\", \n    \"These figures are missing.\"), OBS_CONF = c(FALSE, FALSE, \n    FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE), \n    OBS_CONF_NAME = c(\"Free (free for publication)\", \"Free (free for publication)\", \n    \"Free (free for publication)\", \"Free (free for publication)\", \n    \"Free (free for publication)\", \"Free (free for publication)\", \n    \"Free (free for publication)\", \"Free (free for publication)\", \n    \"Free (free for publication)\", \"Free (free for publication)\"\n    ), URN = c(\"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d6d20100\", \n    \"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d7d20100\", \"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d8d20100\", \n    \"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d9d20100\", \"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d10d20100\", \n    \"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d11d20100\", \"Nm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d5d20100\", \n    \"Nm-202d1d32336e0d1820327938d0d0d0d0d0d0d0d6d20100\", \"Nm-202d1d32336e0d1820327938d0d0d0d0d0d0d0d7d20100\", \n    \"Nm-202d1d32336e0d1820327938d0d0d0d0d0d0d0d8d20100\"), RECORD_OFFSET = c(0, \n    1, 2, 3, 4, 5, 6, 7, 8, 9), RECORD_COUNT = c(2219, 2219, \n    2219, 2219, 2219, 2219, 2219, 2219, 2219, 2219)), row.names = c(NA, \n-10L), class = c(\"tbl_df\", \"tbl\", \"data.frame\")) |> knitr::kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDATE\nDATE_NAME\nDATE_CODE\nDATE_TYPE\nDATE_TYPECODE\nDATE_SORTORDER\nGEOGRAPHY\nGEOGRAPHY_NAME\nGEOGRAPHY_CODE\nGEOGRAPHY_TYPE\nGEOGRAPHY_TYPECODE\nGEOGRAPHY_SORTORDER\nMEASURE\nMEASURE_NAME\nMEASURE_CODE\nMEASURE_TYPE\nMEASURE_TYPECODE\nMEASURE_SORTORDER\nMEASURES\nMEASURES_NAME\nOBS_VALUE\nOBS_STATUS\nOBS_STATUS_NAME\nOBS_CONF\nOBS_CONF_NAME\nURN\nRECORD_OFFSET\nRECORD_COUNT\n\n\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n6\nAge specific fertility rate : Aged 20-24\n6\nmeasures\n1000\n0\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d6d20100\n0\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n7\nAge specific fertility rate : Aged 25-29\n7\nmeasures\n1000\n1\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d7d20100\n1\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n8\nAge specific fertility rate : Aged 30-34\n8\nmeasures\n1000\n2\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d8d20100\n2\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n9\nAge specific fertility rate : Aged 35-39\n9\nmeasures\n1000\n3\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d9d20100\n3\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n10\nAge specific fertility rate : Aged 40-44\n10\nmeasures\n1000\n4\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d10d20100\n4\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n11\nAge specific fertility rate : Aged 45 and over\n11\nmeasures\n1000\n5\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d11d20100\n5\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327937\nDarlington\nE06000005\nlocal authorities: district / unitary (as of April 2019)\n434\n0\n5\nAge specific fertility rate : Aged under 20\n5\nmeasures\n1000\n6\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327937d0d0d0d0d0d0d0d5d20100\n6\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327938\nCounty Durham\nE06000047\nlocal authorities: district / unitary (as of April 2019)\n434\n1\n6\nAge specific fertility rate : Aged 20-24\n6\nmeasures\n1000\n0\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327938d0d0d0d0d0d0d0d6d20100\n7\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327938\nCounty Durham\nE06000047\nlocal authorities: district / unitary (as of April 2019)\n434\n1\n7\nAge specific fertility rate : Aged 25-29\n7\nmeasures\n1000\n1\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327938d0d0d0d0d0d0d0d7d20100\n8\n2219\n\n\n2021\n2021\n2021\ndate\n0\n0\n1820327938\nCounty Durham\nE06000047\nlocal authorities: district / unitary (as of April 2019)\n434\n1\n8\nAge specific fertility rate : Aged 30-34\n8\nmeasures\n1000\n2\n20100\nValue\nNA\nQ\nThese figures are missing.\nFALSE\nFree (free for publication)\nNm-202d1d32336e0d1820327938d0d0d0d0d0d0d0d8d20100\n9\n2219\n\n\n\n\n\nI also tried to download the data manually\n\nand got similarly empty results"
  },
  {
    "objectID": "02_SPHERE-debugging.html#questions",
    "href": "02_SPHERE-debugging.html#questions",
    "title": "SPHERE-debugging",
    "section": "Questions",
    "text": "Questions\n\nWhy S4\nWhy eval(substitute)) when loading S4 methods\nWhy no signature on S4 methods\nAre overrides by hpc_mode = TRUE important?"
  }
]